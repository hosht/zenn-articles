---
title: "--ignore-revã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ç‰¹å®šã‚³ãƒŸãƒƒãƒˆã‚’git blameã‹ã‚‰é™¤å¤–ã™ã‚‹"
emoji: "ğŸ‘»"
type: "tech"
topics: [git, github]
published: true
---

## ã¯ã˜ã‚ã«

çªç„¶ã§ã™ãŒã¿ãªã•ã‚“ã¯`git blame`ã—ã¦ã¾ã™ã‹ï¼Ÿ
ç§ã¯æ¯æ—¥`git blame`ã—ã¦ã„ã¾ã™ï¼
`git blame`ã—ãŸçµæœã€ãã®å·®åˆ†ã‚’ã‚³ãƒŸãƒƒãƒˆã—ãŸã®ã¯éå»ã®è‡ªåˆ†ã¨çŸ¥ã‚‹ã®ã¯æ—¥å¸¸èŒ¶é£¯äº‹ã§ã™ã€‚

`git blame`ã¯ã‚³ãƒ¼ãƒ‰ãƒªãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã®å¼·åŠ›ãªå‘³æ–¹ã§ã™ãŒã€Linterã‚„Formatterã‚’ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹å…¨ä½“ã«é©ç”¨ã™ã‚‹ã¨ã€å·®åˆ†ã®æƒ…å ±ãŒãã‚Œã‚‰ã§ä¸Šæ›¸ãã•ã‚Œã¦ã—ã¾ã„æƒ…å ±é‡ãŒæ¸›ã£ã¦ã—ã¾ã„ã¾ã™ã€‚
ãã®ã‚ˆã†ãªå ´åˆã¯`git history`ã§æ­´å²ã‚’é¡ã‚‹ã—ã‹ãªã„ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ
ã„ã„ãˆã€git v2.23ã‹ã‚‰è¿½åŠ ã•ã‚ŒãŸ[`--ignore-rev`ã‚ªãƒ—ã‚·ãƒ§ãƒ³](https://github.com/git/git/commit/209f0755934a0c9b448408f9b7c9849c15041ecc)ã§æŒ‡å®šã—ãŸã‚³ãƒŸãƒƒãƒˆã‚’blameã‹ã‚‰é™¤å¤–ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

## `git blame --ignore-rev`ã®ä½¿ã„æ–¹

--ignore-revã«ã‚³ãƒŸãƒƒãƒˆãƒãƒƒã‚·ãƒ¥ã‚’æ¸¡ã™ã¨ãã®ã‚³ãƒŸãƒƒãƒˆã¯blameã‹ã‚‰é™¤å¤–ã•ã‚Œã¾ã™ã€‚

```shell
# ã‚³ãƒŸãƒƒãƒˆãƒãƒƒã‚·ãƒ¥ã¯æ¶ç©ºã®ã‚‚ã®ã§ã™
$ git blame --ignore-rev MyF4EkvOZNVKKJKqJv2pV8a2PBKWsyxfK4lTlMya
```

## `blame.ignoreRevsFile`ã‚’è¨­å®šã—ã¦å¸¸ã«Ignoreã•ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹

æ¯å›`--ignore-rev`ã‚’æŒ‡å®šã—ã¦ã„ã¦ã¯é–‹ç™ºè€…ä½“é¨“ãŒè‰¯ãã‚ã‚Šã¾ã›ã‚“ã€‚
ãã‚“ãªã‚ãªãŸã«git-configã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒå­˜åœ¨ã—ã¾ã™ã€‚

```shell
git config --global blame.ignoreRevsFile .git-blame-ignore-revs
```

`.git-blame-ignore-revs`ã«ã¯ã‚³ãƒŸãƒƒãƒˆãƒãƒƒã‚·ãƒ¥ã‚’ç¾…åˆ—ã™ã‚‹ã ã‘ã§ã™ãŒãã‚ŒãŒä½•ã‚’Ignoreã™ã‚‹ã®ã‹ã‚³ãƒ¡ãƒ³ãƒˆã‚’ã¤ã‘ã‚‹ã¨ã‚ã‹ã‚Šã‚„ã™ã„ã§ã—ã‚‡ã†ã€‚

```.git-blame-ignore-revs
# Prettierã§å…¨ã‚³ãƒ¼ãƒ‰ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
MyF4EkvOZNVKKJKqJv2pV8a2PBKWsyxfK4lTlMya
```

ignoreRevsFileã¯ä»»æ„ã®ãƒ•ã‚¡ã‚¤ãƒ«åã‚’æŒ‡å®šã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ãŒã€GitHubã¯`.git-blame-ignore-revs`ã®ãƒ•ã‚¡ã‚¤ãƒ«åã§ä½œæˆã™ã‚‹ã¨Web UIã®blameã§Ignoreã—ã¦ãã‚Œã‚‹ãŸã‚ã€ç‰¹åˆ¥ãªç†ç”±ãŒãªã„é™ã‚Šã“ã®ãƒ•ã‚¡ã‚¤ãƒ«åãŒãŠã™ã™ã‚ã§ã™ã€‚
GitLabã‚‚åŒã˜ãƒ•ã‚¡ã‚¤ãƒ«åã§å¯¾å¿œã™ã‚‹ã‹ã©ã†ã‹ãŒè­°è«–ã•ã‚Œã¦ã„ã¾ã™ã€‚

https://github.blog/changelog/2022-03-24-ignore-commits-in-the-blame-view-beta/
https://docs.github.com/en/repositories/working-with-files/using-files/viewing-a-file#ignore-commits-in-the-blame-view
https://gitlab.com/gitlab-org/gitlab/-/issues/31423


### `blame.markIgnoredLines`ã‚’è¨­å®šã—ã¦Ignoreã•ã‚ŒãŸç®‡æ‰€ã«?ãƒãƒ¼ã‚¯ã‚’ã¤ã‘ã‚‹

`--ignore-rev`ã¾ãŸã¯`blame.ignoreRevsFile`æŒ‡å®šæ™‚ã«`blame.markIgnoredLines true`ã‚’è¨­å®šã™ã‚‹ã¨Ignoreã•ã‚ŒãŸå ´åˆã«?ãƒãƒ¼ã‚¯ã‚’ã¤ã‘ã¦ãŠçŸ¥ã‚‰ã›ã—ã¦ãã‚Œã¾ã™ã€‚(å¾Œè¿°)

```shell
git config --global blame.markIgnoredLines true
```

## ã‚„ã£ã¦ã¿ã‚‹

å®Ÿéš›ã«å‹•ã‹ã—ã¦å‹•ä½œã‚’ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚

### ä¸‹æº–å‚™

```shell
$ mkdir hoge && cd hoge
$ cat << EOF > fuga
foo
bar
bazz
EOF
$ cat fuga
foo
bar
bazz
$ git init
```

### ã‚³ãƒŸãƒƒãƒˆä½œæˆ

```shell
# ã‚³ãƒŸãƒƒãƒˆ1å›ç›®
$ git add fuga
$ git commit --author 'Zenn<zenn@example.com>' -m 'Initial commit'
[main (root-commit) 552350b] Initial commit
 Author: Zenn <zenn@example.com>
 1 file changed, 3 insertions(+)
 create mode 100644 fuga
$ git blame fuga
^552350b (Zenn 2023-02-09 19:34:44 +0900 1) foo
^552350b (Zenn 2023-02-09 19:34:44 +0900 2) bar
^552350b (Zenn 2023-02-09 19:34:44 +0900 3) bazz

# ã‚³ãƒŸãƒƒãƒˆ2å›ç›®
# barã®å‰ã«ã‚¹ãƒšãƒ¼ã‚¹ã‚’2å€‹è¿½åŠ 
$ gsed -i 's/bar/  bar/g' fuga
$ git add fuga
$ git commit --author 'Zenn2<zenn2@example.com>' -m 'Second commit'
[main 5306907] Second commit
 Author: Zenn2 <zenn2@example.com>
 1 file changed, 1 insertion(+), 1 deletion(-)
$ git blame fuga
^552350b (Zenn  2023-02-09 19:34:44 +0900 1) foo
53069075 (Zenn2 2023-02-09 19:54:10 +0900 2)   bar
^552350b (Zenn  2023-02-09 19:34:44 +0900 3) bazz

# ã‚³ãƒŸãƒƒãƒˆ3å›ç›®
$ gsed -i 's/bazz/changed/g' fuga
$ git add fuga
$ git commit --author 'Zenn3<zenn3@example.com>' -m 'Third commit'
[main e85f232] Third commit
 Author: Zenn3 <zenn3@example.com>
 1 file changed, 1 insertion(+), 1 deletion(-)
$ git blame fuga
^552350b (Zenn  2023-02-09 19:34:44 +0900 1) foo
53069075 (Zenn2 2023-02-09 19:54:10 +0900 2)   bar
e85f2322 (Zenn3 2023-02-09 19:55:36 +0900 3) changed
```

### `git blame --ignore-rev`

2å›ç›®ã®ã‚³ãƒŸãƒƒãƒˆã‚’Ignoreã—ã¾ã™

```shell
$ git rev-parse HEAD^1
530690759d090e1af427abfc444a15fe817ca80a
$ git blame --ignore-rev 530690759d090e1af427abfc444a15fe817ca80a fuga
^552350b (Zenn  2023-02-09 19:34:44 +0900 1) foo
^552350b (Zenn  2023-02-09 19:34:44 +0900 2)   bar
e85f2322 (Zenn3 2023-02-09 19:55:36 +0900 3) changed
```

2è¡Œç›®ã®`  bar`ã¯ã‚³ãƒ¼ãƒ‰å·®åˆ†ãŒã‚ã‚Šã¾ã™ãŒ1å›ç›®ã®ã‚³ãƒŸãƒƒãƒˆã®ZennãŒã‚³ãƒŸãƒƒãƒˆã¨ã—ã¦è¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™ã€‚

### `blame.ignoreRevsFile`

```shell
$ cat << EOF > .git-blame-ignore-revs
530690759d090e1af427abfc444a15fe817ca80a
EOF
# --globalã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã¤ã‘ã¦ã„ãªã„ã®ã§ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã®ã¿æœ‰åŠ¹ãªè¨­å®š
$ git config blame.ignoreRevsFile .git-blame-ignore-revs
$ git blame fuga
^552350b (Zenn  2023-02-09 19:34:44 +0900 1) foo
^552350b (Zenn  2023-02-09 19:34:44 +0900 2)   bar
e85f2322 (Zenn3 2023-02-09 19:55:36 +0900 3) changed
```

### `blame.markIgnoredLines true`

```shell
git config blame.markIgnoredLines true
/Users/takanobuhoshino/Downloads/hoge% git blame fuga
^552350b (Zenn  2023-02-09 19:34:44 +0900 1) foo
^?552350 (Zenn  2023-02-09 19:34:44 +0900 2)   bar
e85f2322 (Zenn3 2023-02-09 19:55:36 +0900 3) changed
```

2è¡Œç›®ã®ã‚³ãƒŸãƒƒãƒˆãƒãƒƒã‚·ãƒ¥ã«`?`ãŒæŒ¿å…¥ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚
(`^`ã¯boundary commitã§ã“ã®å ´åˆã¯åˆå›ã®ã‚³ãƒŸãƒƒãƒˆã‚’æŒ‡ã™ãƒãƒ¼ã‚¯)

### `blame.markUnblamableLines true`ã«ã¤ã„ã¦

`--ignore-rev`ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«ã¯`blame.markUnblamableLines`ã‚‚ã‚ã‚Šã¾ã™ãŒã€ã©ã®ã‚ˆã†ãªæ©Ÿèƒ½ã‹èª¬æ˜ã‹ã‚‰ç†è§£ã§ããªã‹ã£ãŸã®ã§å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®èª¬æ˜ã‚’æ·»ãˆã‚‹ã«ã¨ã©ã‚ã¾ã™ã€‚

>Mark lines that were changed by an ignored revision that we could not attribute to another commit with a * in the output of git-blame[1].

## GitLensåˆ©ç”¨æ™‚ã®æ³¨æ„ç‚¹

ä¾¿åˆ©ãª`--ignore-rev`ã§ã™ãŒäººæ°—ã®VSCodeæ‹¡å¼µæ©Ÿèƒ½ã§ã‚ã‚‹GitLensåˆ©ç”¨æ™‚ã«å•é¡ŒãŒã‚ã‚Šã¾ã—ãŸã€‚
`blame.ignoreRevsFile`ã‚’è¨­å®šã—ã¦ã„ã‚‹å ´åˆã«ã€æŒ‡å®šã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯GitLensã®blameãŒæ­£å¸¸ã«æ©Ÿèƒ½ã—ã¾ã›ã‚“ã§ã—ãŸã€‚
IssueãŒä¸ŠãŒã£ã¦ã„ã¾ã™ãŒè§£æ±ºã¯ã—ã¦ã„ãªã„ãŸã‚GitLensãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ–¹ã¯è¨­å®šã«æ°—ã‚’ã¤ã‘ã¾ã—ã‚‡ã†ã€‚

https://github.com/gitkraken/vscode-gitlens/issues/1143

## ã¾ã¨ã‚

`--ignore-rev`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ã†ã“ã¨ã§`git blame`ã‹ã‚‰ç‰¹å®šã®ã‚³ãƒŸãƒƒãƒˆã‚’é™¤å¤–ã™ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚
ã¯ã˜ã‚ã«ã«ã‚‚æ›¸ã„ãŸã‚ˆã†ã«ã€ç‰¹ã«Linterã‚„Formatterã‚’ãƒªãƒã‚¸ãƒˆãƒªã«å…¨ä½“ã«é©ç”¨ã—ãŸã‚±ãƒ¼ã‚¹ã«æœ‰åŠ¹ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ã™ã€‚
blameã«æ”¯éšœãŒå‡ºã‚‹ã‹ã‚‰å®Ÿè¡Œã«èºŠèº‡ã—ã¦ã„ã‚‹ã‚ˆã†ãªæ–¹ã¯ãœã²è¨­å®šã—ã¦ã¿ã¦ãã ã•ã„ã€‚

## å‚è€ƒè³‡æ–™

https://www.git-scm.com/docs/git-blame#Documentation/git-blame.txt---ignore-revs-fileltfilegt
https://www.git-scm.com/docs/git-blame#Documentation/git-blame.txt-blameignoreRevsFile
https://www.michaelheap.com/git-ignore-rev/
https://stackoverflow.com/questions/59537270/why-doesnt-git-blame-ignore-rev-ignore-revs-file-work-for-me
